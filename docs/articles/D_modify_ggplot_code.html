<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modifying the ggplot2 object or code • flowdiagramr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modifying the ggplot2 object or code">
<meta property="og:description" content="flowdiagramr">
<meta property="og:image" content="https://andreashandel.github.io/flowdiagramr/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flowdiagramr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/A_quickstart.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/B_prepare_diagram_settings.html">Modifying diagrams I</a>
    </li>
    <li>
      <a href="../articles/C_update_diagram_function.html">Modifying diagrams II</a>
    </li>
    <li>
      <a href="../articles/D_modify_ggplot_code.html">Modifying the ggplot2 object or code</a>
    </li>
    <li>
      <a href="../articles/E_non_model_diagrams.html">Making non-model based diagrams</a>
    </li>
    <li>
      <a href="../articles/F_additional_examples.html">Additional diagram examples</a>
    </li>
    <li>
      <a href="../articles/G_additional_topics.html">Additional topics</a>
    </li>
    <li>
      <a href="../articles/H_comparison_to_other_packages.html">Comparison to other R packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andreashandel/flowdiagramr" class="external-link">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modifying the ggplot2 object or code</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andreashandel/flowdiagramr/blob/HEAD/vignettes/D_modify_ggplot_code.Rmd" class="external-link"><code>vignettes/D_modify_ggplot_code.Rmd</code></a></small>
      <div class="hidden name"><code>D_modify_ggplot_code.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We assume you went through the previous vignettes that showed you how
to use the functionality provided by <strong>flowdiagramr</strong> to
produce fairly good looking (in our biased opinion) diagrams. We believe
(hope) that this often gives you a diagram you are happy with.</p>
<p>However, occasionally you might want to make additional tweaks beyond
what <strong>flowdiagramr</strong> can do. Fortunately for you, there is
a way to do this, which is the topic of this vignette. There’s one easy
way, and one approach that’s a bit more involved but also more
flexible.</p>
</div>
<div class="section level2">
<h2 id="modifying-the-ggplot-object">Modifying the ggplot object<a class="anchor" aria-label="anchor" href="#modifying-the-ggplot-object"></a>
</h2>
<p>The object returned by <code><a href="../reference/make_diagram.html">make_diagram()</a></code> is a ggplot
object, which means you can do all the things you can do to those
objects. That includes further alterations and updates. Here are a few
simple examples.</p>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>Back to our simple SIR model</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the model</span></span>
<span><span class="va">variables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="st">"I"</span>,<span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">flows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"-b*S*I"</span>, <span class="st">"-m*S"</span><span class="op">)</span>, </span>
<span>             I_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+b*S*I"</span>,<span class="st">"-g*I"</span>, <span class="st">"-m*I"</span><span class="op">)</span>, </span>
<span>             R_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g*I"</span>, <span class="st">"-m*R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sirmodel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variables <span class="op">=</span> <span class="va">variables</span>, flows <span class="op">=</span> <span class="va">flows</span><span class="op">)</span></span>
<span><span class="co"># prepare, make and plot</span></span>
<span><span class="va">diag_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_diagram.html">prepare_diagram</a></span><span class="op">(</span><span class="va">sirmodel</span><span class="op">)</span></span>
<span><span class="va">diag1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_diagram.html">make_diagram</a></span><span class="op">(</span><span class="va">diag_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diag1</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>Let’s assume you want to give it a title and add some more text into
the plot. You can just use the regular <code>ggplot2</code> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diag2</span> <span class="op">&lt;-</span> <span class="va">diag1</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"My diagram"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_label</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fl">2</span>,y<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,label<span class="op">=</span><span class="st">"My label"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diag2</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>This example shows the overall suggested workflow, namely first using
all the functionality that <strong>flowdiagramr</strong> provides, and
then further modifying the plot with <code>ggplot2</code> commands.</p>
<p>For this example, we revisit our somewhat complex 7-compartment
model. This is the code we had previously to get a decent figure.</p>
<p>Model definition</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sc"</span>,<span class="st">"Ic"</span>,<span class="st">"Rc"</span>,<span class="st">"Sa"</span>,<span class="st">"Ia"</span>,<span class="st">"Ra"</span>,<span class="st">"P"</span><span class="op">)</span></span>
<span><span class="va">flows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Sc_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-bcc*Sc*Ic"</span>,<span class="st">"-bca*Sc*Ia"</span>,<span class="st">"-bcp*Sc*P"</span><span class="op">)</span>, </span>
<span>             Ic_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bcc*Sc*Ic"</span>,<span class="st">"bca*Sc*Ia"</span>,<span class="st">"bcp*Sc*P"</span>,<span class="st">"-gc*Ic"</span><span class="op">)</span>, </span>
<span>             Rc_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gc*Ic"</span><span class="op">)</span>,</span>
<span>             Sa_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-bac*Sa*Ic"</span>,<span class="st">"-baa*Sa*Ia"</span>,<span class="st">"-bap*Sa*P"</span><span class="op">)</span>, </span>
<span>             Ia_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bac*Sa*Ic"</span>,<span class="st">"baa*Sa*Ia"</span>,<span class="st">"bap*Sa*P"</span>,<span class="st">"-ga*Ia"</span><span class="op">)</span>, </span>
<span>             Ra_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ga*Ia"</span><span class="op">)</span>,</span>
<span>             P_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rc*Ic"</span>,<span class="st">"ra*Ia"</span>,<span class="st">"-d*P"</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span><span class="va">mymodel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">variables</span>, <span class="va">flows</span><span class="op">)</span></span></code></pre></div>
<p>Basic layout settings</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mysettings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> varlocations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sc"</span>, <span class="st">""</span>, <span class="st">"Ic"</span>, <span class="st">"Rc"</span>,</span>
<span>                                                  <span class="st">""</span>,   <span class="st">"P"</span>, <span class="st">""</span>,   <span class="st">""</span>,</span>
<span>                                                  <span class="st">"Sa"</span>, <span class="st">""</span>, <span class="st">"Ia"</span>, <span class="st">"Ra"</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   varbox_x_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   varspace_x_size <span class="op">=</span> <span class="fl">1.5</span></span>
<span>                   <span class="op">)</span></span></code></pre></div>
<p>List of all styling updates</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define list of updates</span></span>
<span><span class="va">diagram_settings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_fill_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Sc <span class="op">=</span> <span class="st">"#cde9fa"</span>, Ic <span class="op">=</span> <span class="st">"#cde9fa"</span>, </span>
<span>                                            Rc <span class="op">=</span> <span class="st">"#cde9fa"</span>, Sa <span class="op">=</span> <span class="st">"#40f9cf"</span>, </span>
<span>                                            Ia <span class="op">=</span> <span class="st">"#40f9cf"</span>, Ra <span class="op">=</span> <span class="st">"#40f9cf"</span>, </span>
<span>                                            P <span class="op">=</span> <span class="st">"#b2b2b2"</span><span class="op">)</span>,</span>
<span>                         var_outline_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>all <span class="op">=</span> <span class="st">"#031e79"</span><span class="op">)</span>,</span>
<span>                         var_label_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                         var_label_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>all <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>                         flow_label_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                         flow_curvature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i_baaSaIa <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, i_bccScIc <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                                            i_bacSaIc <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, i_bcaScIa <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                                            g_raIa <span class="op">=</span> <span class="fl">0</span>, g_rcIc <span class="op">=</span> <span class="fl">0</span>, i_bcpScP <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                         flow_xstart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i_bcpScP <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, i_bapSaP <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                         flow_ystart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i_bcpScP <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, i_bapSaP <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, i_bacSaIc <span class="op">=</span> <span class="op">-</span><span class="fl">1.1</span>, </span>
<span>                                         i_baaSaIa <span class="op">=</span> <span class="op">-</span><span class="fl">1.1</span>, i_bccScIc <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                         flow_line_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i_baaSaIa <span class="op">=</span> <span class="st">"#40f9cf"</span>, i_bacSaIc <span class="op">=</span> <span class="st">"#cde9fa"</span>,</span>
<span>                                             i_bapSaP <span class="op">=</span> <span class="st">"orange"</span>, i_bcpScP <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>                                             i_bccScIc <span class="op">=</span> <span class="st">"#cde9fa"</span>, i_bcaScIa <span class="op">=</span> <span class="st">"#40f9cf"</span><span class="op">)</span>,</span>
<span>                         flow_line_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>all <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>                         flow_xlabel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i_bcaScIa <span class="op">=</span> <span class="fl">1</span>, i_bacSaIc <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                                         i_bapSaP <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span>, i_bcpScP <span class="op">=</span> <span class="op">-</span><span class="fl">2.25</span>,</span>
<span>                                         g_raIa <span class="op">=</span> <span class="fl">0.15</span>, g_rcIc <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span>, </span>
<span>                         flow_ylabel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m_gcIc <span class="op">=</span> <span class="fl">0.25</span>, m_gaIa <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                                         i_bcaScIa <span class="op">=</span> <span class="op">-</span><span class="fl">2.5</span>, i_bacSaIc <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, </span>
<span>                                         i_baaSaIa <span class="op">=</span> <span class="op">-</span><span class="fl">2.15</span>, i_bccScIc <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, </span>
<span>                                         e_dP <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>                                         g_raIa <span class="op">=</span> <span class="fl">0.5</span>, g_rcIc <span class="op">=</span> <span class="op">-</span><span class="fl">0.75</span><span class="op">)</span></span>
<span>                        </span>
<span>                         <span class="op">)</span></span></code></pre></div>
<p>Prepare, update and make the diagram.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagram_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_diagram.html">prepare_diagram</a></span><span class="op">(</span><span class="va">mymodel</span>, <span class="va">mysettings</span><span class="op">)</span></span>
<span><span class="va">diagram_list2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_diagram.html">update_diagram</a></span><span class="op">(</span><span class="va">diagram_list</span>, <span class="va">diagram_settings</span><span class="op">)</span></span>
<span><span class="va">diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_diagram.html">make_diagram</a></span><span class="op">(</span><span class="va">diagram_list2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diag</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Notice that we made a change above, we didn’t add the full text to
the boxes but kept the variable names. Let’s assume we want to add the
full text next to the boxes. We can simply add them as text to the
<code>ggplot</code> object, like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_label_text</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Sc <span class="op">=</span> <span class="st">"Susceptible\n Children"</span>, Ic <span class="op">=</span> <span class="st">"Infected\n Children"</span>, Rc <span class="op">=</span> <span class="st">"Recovered\n Children"</span>,</span>
<span>                   Sa <span class="op">=</span> <span class="st">"Susceptible\n Adults"</span>,   Ia <span class="op">=</span> <span class="st">"Infected\n Adults"</span>,   Ra <span class="op">=</span> <span class="st">"Recovered\n Adults"</span>,</span>
<span>                   P <span class="op">=</span> <span class="st">"Pathogen in\n Environment"</span><span class="op">)</span></span>
<span><span class="va">xpos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">9</span>,<span class="fl">12.5</span>,<span class="fl">2</span>,<span class="fl">9</span>,<span class="fl">12.5</span>,<span class="fl">3.5</span><span class="op">)</span></span>
<span><span class="va">ypos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.5</span>,<span class="fl">5.5</span>,<span class="fl">3.5</span>, <span class="fl">1.5</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">1.5</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">diag2</span> <span class="op">&lt;-</span> <span class="va">diag</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"7 compartment model"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">xpos</span>, y <span class="op">=</span> <span class="va">ypos</span>, label <span class="op">=</span> <span class="va">var_label_text</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diag2</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-8-1.png" width="672">
This is not perfect and needs a bit more tweaking, but you get the idea.
This approach allows you to add or modify the ggplot object returned
from flowdiagramr any way you want.</p>
</div>
</div>
<div class="section level2">
<h2 id="modifying-the-ggplot2-code">Modifying the ggplot2 code<a class="anchor" aria-label="anchor" href="#modifying-the-ggplot2-code"></a>
</h2>
<p>While the above approach toward modifying the <code>ggplot</code>
object returned by <code><a href="../reference/make_diagram.html">make_diagram()</a></code> gives you some additional
flexibility, you can go a step further. The most flexible approach to
adjust diagrams is to modify the ggplot code that produces the diagram.
<strong>flowdiagramr</strong> provides a function that returns the code,
which you can then edit like you would any <code>ggplot</code> code.
We’ll illustrate this approach with a few examples.</p>
<div class="section level3">
<h3 id="example-1-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1-1"></a>
</h3>
<p>First, you define your model as usual.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the model</span></span>
<span><span class="va">variables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="st">"I"</span>,<span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">flows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"-b*S*I"</span>, <span class="st">"-m*S"</span><span class="op">)</span>, </span>
<span>             I_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+b*S*I"</span>,<span class="st">"-g*I"</span>, <span class="st">"-m*I"</span><span class="op">)</span>, </span>
<span>             R_flows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g*I"</span>, <span class="st">"-m*R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sirmodel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variables <span class="op">=</span> <span class="va">variables</span>, flows <span class="op">=</span> <span class="va">flows</span><span class="op">)</span></span></code></pre></div>
<p>Next, you prepare the model</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diag_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_diagram.html">prepare_diagram</a></span><span class="op">(</span><span class="va">sirmodel</span><span class="op">)</span></span></code></pre></div>
<p>Once you have the diagram list ready, you can send it to
<code>write_diagram</code>, a function that writes the full code needed
to generate the diagram. You can specify the location and name for the
file. If you don’t provide those, it will be stored in the current
working directory under the name <code>diagram_code.R</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write the current diagram code to a file, overwrite if it exists</span></span>
<span><span class="fu"><a href="../reference/write_diagram.html">write_diagram</a></span><span class="op">(</span>diagram_list <span class="op">=</span> <span class="va">diag_list</span>, filename <span class="op">=</span> <span class="st">'model1_diagram_code.R'</span>, always_overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If things worked well, you should get a message telling you the
location where the code was saved. The code that is generated is
completely self-contained, that means you can give it to anyone, who can
run it and reproduce your model figure.</p>
<p>If you run the code that is generated, it will create the diagram
structure as an object called <code>diagram_plot</code>. You can then
plot or save that object (there is code at the bottom of the generated
file for that).</p>
<p>For this example, here is what you get.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">'model1_diagram_code.R'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diagram_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Having all the code that generates the figure allows you to do some
fine-tuning. We provided hopefully enough comments in the code to make
it clear what happens where. That said, to be able to tweak the diagram
this way requires being familiar with creating figures in ggplot.</p>
<p>Let’s assume for this example that you want to add some text below
the <code>I</code> compartment. In this case, you don’t need to modify
any of the existing code, just add a some code at the end. As shown
above, you could do this by just modifying the <code>ggplot</code>
object returned from flowdiagramr. But here we’ll do it by editing the
code.</p>
<p>The following lines of code appended to the bottom of
<code>sirmodel1_diagram_code.R</code>, just before the final
<code>plot</code> statement, will do the trick:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#######################</span></span>
<span><span class="co">### LAST PART OF THE GENERATED CODE BEFORE ADDITION</span></span>
<span><span class="co">#######################</span></span>
<span><span class="va">with_grid</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>  <span class="co"># default is false</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">with_grid</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">diagram_plot</span> <span class="op">&lt;-</span> <span class="va">diagram_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span>  <span class="co"># makes an empty plot theme with no axes, grids, or ticks</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># The else here may seem silly, but otherwise the returned plot is NULL</span></span>
<span>  <span class="va">diagram_plot</span> <span class="op">&lt;-</span> <span class="va">diagram_plot</span>  <span class="co"># just returns default ggplot2 theme</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################</span></span>
<span><span class="co">### YOUR NEW ADDITION</span></span>
<span><span class="co">#######################</span></span>
<span><span class="co"># make a new data frame of text</span></span>
<span><span class="va">text_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>  x <span class="op">=</span> <span class="fl">3</span>,  y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  lab <span class="op">=</span> <span class="st">"Infected and Infectious"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">diagram_plot</span> <span class="op">&lt;-</span> <span class="va">diagram_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">text_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">lab</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#######################</span></span>
<span><span class="co">### PART OF THE GENERATED CODE AFTER ADDITION</span></span>
<span><span class="co">#######################</span></span>
<span><span class="co"># These lines plot or save the generated diagram. </span></span>
<span><span class="co"># Uncomment them if you want to perform either action. </span></span>
<span><span class="co"># plot(diagram_plot) </span></span>
<span><span class="co"># ggsave('diagram_plot.png',diagram_plot)</span></span></code></pre></div>
<p>Then save the new code, let’s call it
<code>sirmodel1_diagram_code_modified.R</code>. Running the new code
will add the wanted text to the diagram plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">'model1_diagram_code_modified.R'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diagram_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-2-1">Example 2<a class="anchor" aria-label="anchor" href="#example-2-1"></a>
</h3>
<p>Let’s look at another example, one that requires this approach. For
that, we again consider the 7-compartment model. Assume we done all our
styling using the <strong>flowdiagramr</strong> functions as above. But
we want to do something that is currently not supported, namely changing
the shape of one of the variables.</p>
<p>To do that, we take the diagram list we produced above and write the
code to a file, then edit it.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_diagram.html">write_diagram</a></span><span class="op">(</span>diagram_list <span class="op">=</span> <span class="va">diagram_list2</span>,</span>
<span>              filename <span class="op">=</span> <span class="st">'model2_diagram_code.R'</span>,</span>
<span>              always_overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you run the code that is generated, you should see a figure like
this</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">'model2_diagram_code.R'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diagram_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>Now let’s turn the shape of the <code>P</code> box into a circle. You
can find the part of the code that creates the boxes (it’s the first for
loop) and modify as follows:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#######################</span></span>
<span><span class="co">### LAST PART OF THE GENERATED CODE BEFORE ADDITION</span></span>
<span><span class="co">#######################</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co">#######################</span></span>
<span><span class="co">### YOUR NEW ADDITION</span></span>
<span><span class="co">#######################</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">variables</span><span class="op">$</span><span class="va">name</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"P"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">diagram_plot</span> <span class="op">&lt;-</span> <span class="va">diagram_plot</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_point</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>,</span>
<span>        <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xmin</span><span class="op">+</span><span class="op">(</span><span class="va">xmax</span><span class="op">-</span><span class="va">xmin</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, y <span class="op">=</span> <span class="va">ymin</span><span class="op">+</span><span class="op">(</span><span class="va">ymax</span><span class="op">-</span><span class="va">ymin</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="co">#centers</span></span>
<span>        color <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="st">"outline_color"</span><span class="op">]</span>,</span>
<span>        fill <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="st">"fill_color"</span><span class="op">]</span>,</span>
<span>        shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">23</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co">#######################</span></span>
<span>  <span class="co">### END YOUR NEW ADDITION</span></span>
<span>  <span class="co">#######################</span></span>
<span> <span class="va">diagram_plot</span> <span class="op">&lt;-</span> <span class="va">diagram_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_rect</span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>,</span>
<span>      <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">xmax</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span>,</span>
<span>      color <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="st">"outline_color"</span><span class="op">]</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">variables</span><span class="op">[</span><span class="va">i</span>, <span class="st">"fill_color"</span><span class="op">]</span></span>
<span>       <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now save the modified script, source it and plot the generated
<code>diagram_plot</code> object to get this figure:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">'model2_diagram_code_modified.R'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diagram_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="D_modify_ggplot_code_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>Again, not quite there yet. We would need to update placement of some
of the arrows. Since we modified the ggplot code, we either need to make
further modifications also in the ggplot code. Alternatively, one can
adjust as much as possible previously. E.g., in this case, adjust arrow
placement above in anticipation of this change later in the code.</p>
</div>
</div>
<div class="section level2">
<h2 id="general-suggestions">General suggestions<a class="anchor" aria-label="anchor" href="#general-suggestions"></a>
</h2>
<p>It should be clear from these examples that once you have the ggplot
code, you can do any modifications you want. At this point, the options
are endless and you can change the code to get exactly what you want -
at the expense of having to write/edit code yourself.</p>
<p>As mentioned before, the best workflow is to use the
<strong>flowdiagramr</strong> functionality to get as far as it takes
you, and then as needed make further manual modifications.</p>
<p>Of course, once you have started manual editing of the code, things
are not reversible, i.e. you have basically left the
<strong>flowdiagramr</strong> package infrastructure and are now
adjusting the diagram on your own. You can of course always re-generate
the code and copy your modifications over (as long as you remember to
not overwrite your code.)</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>This concludes the main tutorials for the package. Several additional
vignettes are available. You can access all <a href="https://andreashandel.github.io/flowdiagramr/" class="external-link">from the package
website</a>.</p>
<p>While <strong>flowdiagramr</strong> was designed with
compartmental/systems modeling in mind, you can use it to create
diagrams for anything consisting of nodes/boxes and flows/arrows. One of
the vignettes provides some examples.</p>
<p>A fairly long vignette shows a lot of further model examples, and
provides some tips on how to make good-looking diagrams even if
<strong>flowdiagramr</strong> doesn’t fully cooperate. We recommend you
check that one out.</p>
<p>Another vignette discusses additional topics such as using
<strong>flowdiagramr</strong> together with our <a href="https://ahgroup.github.io/modelbuilder/" class="external-link">modelbuilder package</a>
and how to crop white space around the diagrams.</p>
<p>We also have a short vignette that compares
<strong>flowdiagramr</strong> to similar R packages.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.andreashandel.com" class="external-link">Andreas Handel</a>, Andrew Tredennick.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
