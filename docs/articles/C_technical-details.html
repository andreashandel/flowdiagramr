<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Technical details • flowdiagramr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Technical details">
<meta property="og:description" content="flowdiagramr">
<meta property="og:image" content="https://andreashandel.github.io/flowdiagramr/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flowdiagramr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/quickstart.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_quickstart.html">A quick start to flowdiagramr</a>
    </li>
    <li>
      <a href="../articles/B_modify-diagrams-simple.html">Basic modification of a diagram</a>
    </li>
    <li>
      <a href="../articles/C_technical-details.html">Technical details</a>
    </li>
    <li>
      <a href="../articles/D_modify-diagrams-advanced.html">Advanced modification of a diagram</a>
    </li>
    <li>
      <a href="../articles/E_non_model_diagrams.html">Other Diagrams</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andreashandel/flowdiagramr">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="C_technical-details_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Technical details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andreashandel/flowdiagramr/blob/master/vignettes/C_technical-details.Rmd"><code>vignettes/C_technical-details.Rmd</code></a></small>
      <div class="hidden name"><code>C_technical-details.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">pkg</span> <span class="op">=</span> <span class="st">'flowdiagramr'</span> <span class="co">#so we can easily switch names</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">pkg</span>, character.only = <span class="fl">TRUE</span>)
</pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>We assume you went through the <a href="">getting started vignette</a> and also the <a href="">basic modification vignette</a>. If the basic modifications you can do give you what you want, there is no need to dig deeper and understand in more detail how <strong>flowdiagramr</strong> works. However, it is quite likely that at some point, you want to further tweak your diagram. To do so successfully, it is useful to learn some more details about how the package works.</p>
<p>As you learned, producing a diagram with <strong>flowdiagramr</strong> involves two steps. After you have defined your model, there is a first step that takes your model and creates a list of data frames (which we called the <code>input_structure</code> in the prior vignettes). These data frames are used by <code>make_diagram</code> to produce the ggplot code and figure. Going back to the SIR model, these are the steps</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">#Set up model</span>
<span class="kw">varlabels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"S"</span>,<span class="st">"I"</span>,<span class="st">"R"</span>)
<span class="kw">varnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Susceptible"</span>,<span class="st">"Infected"</span>,<span class="st">"Recovered"</span>)
<span class="co"># currently only works with trailing + signs</span>
<span class="kw">flows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(S_flows = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"+n"</span>, <span class="st">"-b*S*I"</span>, <span class="st">"-m*S"</span>), 
             I_flows = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"+b*S*I"</span>,<span class="st">"-g*I"</span>, <span class="st">"-m*I"</span>), 
             R_flows = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"+g*I"</span>, <span class="st">"-m*R"</span>))
<span class="kw">sirmodel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(varlabels = <span class="kw">varlabels</span>, varnames = <span class="kw">varnames</span>, flows = <span class="kw">flows</span>)
<span class="co"># step 1: prepare inputs </span>
<span class="kw">sir_input_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_diagram.html">prepare_diagram</a></span>(<span class="kw">sirmodel</span>)
<span class="co"># step 2: make diagram</span>
<span class="kw">sir_diagram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_diagram.html">make_diagram</a></span>(<span class="kw">sir_input_structure</span>)
</pre></div>
<p>The object returned after calling <code>prepare_diagram</code> contains data frames that have information stored in a way that it is fairly easy to use in ggplot diagram generation.</p>
<p>Here are the details contained in this object</p>
<p>Five (5) data frames are produced based on the model structure:</p>
<p>EXPLAIN WHICH NEED TO BE PRESENT AND WHICH CAN BE MISSING/EMPTY</p>
<ol style="list-style-type: decimal">
<li>
<code>nodes</code>: a data frame with four columns - ALSO ROW?
<ul>
<li>
<code>id</code>: the node (variable) id number, used to match with the edge data frames</li>
<li>
<code>label</code>: the label of the node (variable), e.g. “S” for susceptible</li>
<li>
<code>x</code>: the x position of the node box CENTER OR CORNER?</li>
<li>
<code>y</code>: the y position of the node box</li>
</ul>
</li>
<li>
<code>horizontal_edges</code>: a data frame with 9 columns
<ul>
<li>
<code>to</code>: the <code>id</code> of the node <em>to which</em> the flow terminates (e.g., arrow points toward this node)</li>
<li>
<code>from</code>: the <code>id</code> of the node <em>from which</em> the flow origins (e.g., arrow points away this node)</li>
<li>
<code>label</code>: the label of the flow to appear next to the line segment, typically an equation</li>
<li>
<code>xstart</code>: the starting x position of the line segment</li>
<li>
<code>ystart</code>: the starting y position of the line segment</li>
<li>
<code>xend</code>: the ending x position of the line segment</li>
<li>
<code>yend</code>: the ending y position of the line segment</li>
<li>
<code>xmid</code>: the x midpoint of the line segment, for intersections with other segments due to interactions</li>
<li>
<code>ymid</code>: the y midpoint of the line segment, for intersections with other segments due to interactions</li>
</ul>
</li>
<li>
<code>vertical_edges</code>: a data frame with 9 columns (same as <code>horizontal_edges</code>)</li>
<li>
<code>curved_edges</code>: a data frame with 9 columns (same as <code>horizontal_edges</code>)</li>
<li>
<code>feedback_edges</code>: a data frame with 9 columns (same as <code>horizontal_edges</code>)</li>
</ol>
<p>The package attempts to make intelligent choices on which flows belong in which data frame. For example, flows into or out of the system with only one node intersection are typically vertical. And flows that bypass a node are typically curved. The user may need to make modifications to suite their particular needs and style.</p>
<p>The data frames above are returned as a list. In some cases, many of the data frames will be empty, as is this case in this example with a relatively simple model.</p>
<p>Here is an example of the list of data frames for the SIR model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">sir_input_structure</span>)
<span class="co">#&gt; $nodes</span>
<span class="co">#&gt;   id label row  x  y</span>
<span class="co">#&gt; 1  1     S   1  6 -2</span>
<span class="co">#&gt; 2  2     I   1  9 -2</span>
<span class="co">#&gt; 3  3     R   1 12 -2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $horizontal_edges</span>
<span class="co">#&gt;   to from label interaction link xstart ystart xend yend xmid  ymid</span>
<span class="co">#&gt; 2  2    1             FALSE   NA      6     -2    9   -2  7.5 -1.75</span>
<span class="co">#&gt; 3  3    2   g*I       FALSE   NA      9     -2   12   -2 10.5 -1.75</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $vertical_edges</span>
<span class="co">#&gt;     to  from label interaction link xstart ystart xend yend  xmid  ymid</span>
<span class="co">#&gt; 1    1 -9991     n       FALSE   NA    5.5   -1.0  6.0 -1.5  5.75 -1.00</span>
<span class="co">#&gt; 5 9991     1   m*S       FALSE   NA    6.0   -2.5  6.5 -3.0  6.00 -2.75</span>
<span class="co">#&gt; 6 9992     2   m*I       FALSE   NA    9.0   -2.5  9.5 -3.0  9.00 -2.75</span>
<span class="co">#&gt; 7 9993     3   m*R       FALSE   NA   12.0   -2.5 12.5 -3.0 12.00 -2.75</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $curved_edges</span>
<span class="co">#&gt;     to from label interaction link xstart ystart xend yend xmid  ymid curvature</span>
<span class="co">#&gt; 1 5551    2 b*S*I        TRUE    1      9   -1.5  7.5   -2 8.25 -1.25       0.4</span>
<span class="co">#&gt;   row labelx labely</span>
<span class="co">#&gt; 1   1   8.15  -1.25</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $feedback_edges</span>
<span class="co">#&gt;  [1] to          from        label       interaction link        xstart     </span>
<span class="co">#&gt;  [7] ystart      xend        yend        xmid        ymid       </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span>
</pre></div>
<p>Here is another example, the predator prey model you saw in earlier vignettes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">varlabels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"B"</span>,<span class="st">"I"</span>)
<span class="kw">varnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Bacteria"</span>,<span class="st">"Immunity"</span>)
<span class="kw">flows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(B_flows = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"g*B"</span>, <span class="st">"-dB*B"</span>, <span class="st">"-k*B*I"</span>), 
             I_flows = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"r*B*I"</span>, <span class="st">"-dI*I"</span>))
<span class="co">#this is the actual model that needs to be used</span>
<span class="co">#but currently it doesn't work, prepare_diagram complains</span>
<span class="co">#flows = list(B_flows = c("g*B*(1-B/Bmax)", "-dB*B", "-k*B*I"), </span>
<span class="co">#                I_flows = c("r*B*I", "-dI*I"))</span>
<span class="kw">ppmodel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(varlabels = <span class="kw">varlabels</span>, varnames = <span class="kw">varnames</span>, flows = <span class="kw">flows</span>)
<span class="kw">pp_input_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_diagram.html">prepare_diagram</a></span>(<span class="kw">ppmodel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">pp_input_structure</span>)
<span class="co">#&gt; $nodes</span>
<span class="co">#&gt;   id label row x  y</span>
<span class="co">#&gt; 1  1     B   1 3 -2</span>
<span class="co">#&gt; 2  2     I   1 6 -2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $horizontal_edges</span>
<span class="co">#&gt;  [1] to          from        label       interaction link        xstart     </span>
<span class="co">#&gt;  [7] ystart      xend        yend        xmid        ymid       </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $vertical_edges</span>
<span class="co">#&gt;     to from label interaction link xstart ystart xend yend xmid  ymid</span>
<span class="co">#&gt; 2 9991    1  dB*B       FALSE   NA      3   -2.5  3.5   -3    3 -2.75</span>
<span class="co">#&gt; 3 9992    2  dI*I       FALSE   NA      6   -2.5  6.5   -3    6 -2.75</span>
<span class="co">#&gt; 4 9993    1             FALSE   NA      3   -2.5  3.5   -3    3 -2.75</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $curved_edges</span>
<span class="co">#&gt;     to from label interaction link xstart ystart xend yend xmid  ymid curvature</span>
<span class="co">#&gt; 1 5551    2 k*B*I        TRUE    1      6   -1.5  4.5   -2 5.25 -1.25       0.4</span>
<span class="co">#&gt;   row labelx labely</span>
<span class="co">#&gt; 1   1   5.15  -1.25</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $feedback_edges</span>
<span class="co">#&gt;  [1] to          from        label       interaction link        xstart     </span>
<span class="co">#&gt;  [7] ystart      xend        yend        xmid        ymid       </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span>
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.andreashandel.com">Andreas Handel</a>, Andrew Tredennick.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
